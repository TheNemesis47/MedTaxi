<!DOCTYPE html>
<html>
<head>
    <title>Visualizza la Rotta</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-7VoL5g7xLox1cZA9KVYEAu6l34FZ-tQ&callback=initMap&libraries=maps,marker&v=beta"></script>
    <script>
        var map;
        var directionsService;
        var directionsRenderer;
        var waypointMarker;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 0, lng: 0 },
                zoom: 6
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);

            // Crea un waypoint vuoto all'inizio
            waypointMarker = new google.maps.Marker({
                position: { lat: 0, lng: 0 },
                map: map,
                icon: 'default-icon.png', // Imposta l'icona del waypoint
                title: 'Waypoint'
            });

            calculateAndDisplayRoute();
        }

        function calculateAndDisplayRoute(start, end) {
            var request = {
                origin: start,
                destination: end,
                travelMode: 'DRIVING'
            };

            directionsService.route(request, function(result, status) {
                if (status == 'OK') {
                    directionsRenderer.setDirections(result);
                }
            });
        }

        function setRouteCoordinates(latStart, lngStart, latEnd, lngEnd) {
            var start = new google.maps.LatLng(latStart, lngStart);
            var end = new google.maps.LatLng(latEnd, lngEnd);

            // Aggiorna il waypoint con le nuove coordinate
            waypointMarker.setPosition(start);

            calculateAndDisplayRoute(start, end);
        }

        function updateMapWithNewCoordinate(lat, lng) {
            // Assuming you have a marker or a way to display the new position on the map
            var newLatLng = new google.maps.LatLng(lat, lng);
            waypointMarker.setPosition(newLatLng); // Update the position of the marker

            // Optionally, if you want to center the map on the new position:
            map.setCenter(newLatLng);
        }

        function setWaypointCoordinates(lat, lng) {
            var waypointMarker = new google.maps.Marker({
                position: { lat: lat, lng: lng },
                map: map,
                icon: 'default-icon.png', // Imposta l'icona del waypoint
                title: 'Waypoint'
            });
        }

    </script>
</head>
<body onload="initMap()">
<div id="map" style="height: 400px;"></div>
</body>
</html>
